---
layout: post
---

1. **`BIOS`阶段**：接通电源，BIOS执行`开机自检`，初始化系统硬件组件，从加载的磁盘中查找`MBR`。如果找到，读取MBR并**加载其中的引导程序到内存**。
2. **`MBR`阶段**：引导程序根据MBR记录，发现`可启动的设备`，加载`GRUB2`引导配置，并**将控制权转交给`GRUB2`**。
3. **`GRUB2`阶段**：GRUB2将`压缩的内核镜像文件vmlinuz`加载到内存，将`驱动initramfs`解压到一个`临时的基于内存的文件系统tmpfs`。同时将**控制权转交给内核**。（备注：控制台输出日志中**不会**包含前面这三个过程，因为在**内核模块加载前，终端等设备尚不能被内核调用**，无法记录其信息。）
4. **内核阶段**：内核**挂载**文件系统tmpfs，通过其中的一些必须的块设备驱动模块，初始化硬件，访问真实的根文件系统。并**以进程号`1`启动`systemd`进程**。
![1875ceb6431d3b361e770361.png](/assets/img/1875ceb6431d3b361e770361.png)
上图中的**`probing EDD`**的过程可以理解为**内核识别设备**的过程。紧接着接收来自 BIOS 的**内存映射报告**等，内核开始工作，启动系统。该**日志**会同步记录到系统的`/var/log/dmesg`中。
5. Systemd 将 temfs 文件系统挂载在**/sysroot**，按照**initd**设置启动系统服务
![bbc02bd9412e9c934b76f2ea.png](/assets/img/bbc02bd9412e9c934b76f2ea.png)
**dmesg**并不会记录所有输出到控制台的信息，比如上图中的挂载**/sysroot**的过程和下面切换**根文件系统/**的过程。在这种时候，如果启动有问题，控制台日志能比较清楚地记录系统已经启动到哪个阶段。
6. 内核根文件系统从 **initramfs/sysroot** 切换到 /
![8148f85f010ecccc84f37c02.png](/assets/img/8148f85f010ecccc84f37c02.png)
如果根文件系统有问题，或者其他的文件系统文件，经常在这个过程中会被卡住。需要用户接入手动修复文件系统等。
7. **Systemd** 根据系统默认启动级别，自动**解决**服务间的依赖关系并**启动服务**。完成后，登录界面弹出。